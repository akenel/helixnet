tls:
  certificates:
    - certFile: /etc/traefik/certs/_wildcard.helix.local.pem
      keyFile: /etc/traefik/certs/_wildcard.helix.local-key.pem
http:
  middlewares:
    keycloak-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
# In traefik/dynamic/dynamic.yml 
    stripprefix:
      stripPrefix:
        prefixes:
          - /api
  routers:
    # ‚îÄ‚îÄ PUBLIC ACCESS (HTTP, path-based for SSH tunnel via DO) ‚îÄ‚îÄ
    public-keycloak:
      rule: "PathPrefix(`/realms`) || PathPrefix(`/resources`) || PathPrefix(`/js`) || PathPrefix(`/admin`)"
      service: keycloak
      entryPoints: [web]
      priority: 100
    public-app:
      rule: "PathPrefix(`/`)"
      service: helix-platform
      entryPoints: [web]
      priority: 1
    # ‚îÄ‚îÄ LOCAL ACCESS (HTTPS, host-based) ‚îÄ‚îÄ
    keycloak:
      entryPoints:
        - websecure
      rule: "Host(`keycloak.helix.local`)"
      service: keycloak
      middlewares:
        - keycloak-headers
    dashboard:
      rule: Host(`traefik.helix.local`)
      entryPoints: [websecure]
      service: api@internal
      tls: {}
    helix-platform:
      rule: "Host(`helix-platform.local`)"
      service: helix-platform
      entryPoints:
        - websecure
      tls: {}
    helix:
      rule: Host(`helix.local`)
      entryPoints:
        - websecure
      service: helix-platform
      tls: {}
    redis:
      rule: "Host(`redis.helix.local`)"
      service: redis
      entryPoints: [websecure]
      tls: {}
    redis-ui:
      rule: "Host(`redis-ui.helix.local`)"
      service: redis-ui
      entryPoints: [websecure]
      tls: {}
    rabbitmq:
      rule: "Host(`rabbitmq.helix.local`)"
      service: rabbitmq
      entryPoints: [websecure]
      tls: {}
    # Application mappings üõ†Ô∏è
    flower:
        rule: "Host(`flower.helix.local`)"
        service: flower
        entryPoints: [websecure]
        tls: {}
    ollama:
      rule: "Host(`ollama.helix.local`)"
      service: ollama
      entryPoints: [websecure]
      tls: {}
    n8n:
      rule: "Host(`n8n.helix.local`)"
      service: n8n
      entryPoints: [websecure]
      tls: {}
    grafana:
      rule: "Host(`grafana.helix.local`)"
      service: grafana
      entryPoints: [websecure]
      tls: {}
    prometheus:
      rule: "Host(`prometheus.helix.local`)"
      service: prometheus
      entryPoints: [websecure]
      tls: {}
    mailhog:
      rule: "Host(`mailhog.helix.local`)"
      service: mailhog
      entryPoints: [websecure]
      tls: {}
    vault:
      rule: "Host(`vault.helix.local`)"
      service: vault
      entryPoints: [websecure]
      tls: {}
    minio:
      rule: "Host(`minio.helix.local`)"
      service: minio
      entryPoints: [websecure]
      tls: {}
    minio-console:
      rule: "Host(`minio.helix.local`)"
      service: minio
      entryPoints: [websecure]
      tls: {}
    openwebui:
      rule: "Host(`openwebui.helix.local`)"
      service: openwebui
      entryPoints: [websecure]
      tls: {}
    qdrant:
      rule: "Host(`qdrant.helix.local`)"
      service: qdrant
      entryPoints: [websecure]
      tls: {}
    filebrowser:
      rule: "Host(`filebrowser.helix.local`)"
      service: filebrowser
      entryPoints: [websecure]
      tls: {}
    moodle:
      rule: "Host(`moodle.helix.local`)"
      service: moodle
      entryPoints: [websecure]
      tls: {}
    adminer:
      rule: "Host(`adminer.helix.local`)"
      service: adminer
      entryPoints: [websecure]
      tls: {}
    medusa:
      rule: "Host(`medusa.helix.local`)"
      service: medusa
      entryPoints: [websecure]
      tls: {}
    portainer:
      rule: "Host(`portainer.helix.local`)"
      service: portainer
      entryPoints: [websecure]
      tls: {}
    dozzle:
      rule: "Host(`dozzle.helix.local`)"
      service: dozzle
      entryPoints: [websecure]
      tls: {}
    music:
      rule: "Host(`music.helix.local`)"
      service: music
      entryPoints: [websecure]
      tls: {}
    teller:
      rule: "Host(`teller.helix.local`)"
      service: teller
      entryPoints: [websecure]
      tls: {}
    video:
      rule: "Host(`video.helix.local`)"
      service: video
      entryPoints: [websecure]
      tls: {}
# üîé Traefik Dashboard
    traefik_dashboard:
      rule: "Host(`traefik.helix.local`) && (PathPrefix(`/dashboard`) || PathPrefix(`/api`))"
      service: api@internal
      entryPoints: [websecure]
      tls: {}

# Backend mappings üõ†Ô∏è
  services:
    keycloak:
      loadBalancer:
        servers:
# Use the http container name ('keycloak') and the internal listening port (8080)
          - url: http://keycloak:8080  
    helix-platform:
      loadBalancer:
        servers:
          - url: http://helix-platform:8000  
    portainer:
      loadBalancer:
        servers:
          - url: "http://portainer:9000"
    ollama:
      loadBalancer:
        servers:
          - url: "http://ollama:11434"
    n8n:
      loadBalancer:
        servers:
          - url: "http://n8n:5678"
    grafana:
      loadBalancer:
        servers:
          - url: "http://grafana:3000"
    prometheus:
      loadBalancer:
        servers:
          - url: "http://prometheus:9090"
    mailhog:
      loadBalancer:
        servers:
          - url: "http://mailhog:8025"
    vault:
      loadBalancer:
        servers:
          - url: "http://vault:8200"
    minio:
      loadBalancer:
        servers:
          - url: "http://minio:9000"
    minio-console:
      loadBalancer:
        servers:
          - url: "http://minio:9001"
    openwebui:
      loadBalancer:
        servers:
          - url: "http://openwebui:8080"
    qdrant:
      loadBalancer:
        servers:
          - url: "http://qdrant:6333"
    filebrowser:
      loadBalancer:
        servers:
          - url: "http://filebrowser:80"
    moodle:
      loadBalancer:
        servers:
          - url: "http://moodle:80"
    adminer:
      loadBalancer:
        servers:
          - url: "http://adminer:8080"
    medusa:
      loadBalancer:
        servers:
          - url: "http://medusa:8080"
    redis:
      loadBalancer:
        servers:
          - url: "http://redis:6379"
    redis-ui:
      loadBalancer:
        servers:
          - url: "http://redis-ui:5540"  
    rabbitmq:
      loadBalancer:
        servers:
          - url: "http://rabbitmq:15672" 
    flower:
      loadBalancer:
        servers:
          - url: "http://flower:5555"
    dozzle:
      loadBalancer:
        servers:
          - url: "http://dozzle:8080"
    music:
      loadBalancer:
        servers:
          - url: "http://helix-music:1970"
    teller:
      loadBalancer:
        servers:
          - url: "http://helix-teller:7791"
    video:
      loadBalancer:
        servers:
          - url: "http://helix-video:8096"
    # Traefik Dashboard
    api@internal:
      loadBalancer:
        servers:
          - url: "http://traefik:8080"
    helix:
      loadBalancer:
        servers:
          - url: "http://helix:8000"
